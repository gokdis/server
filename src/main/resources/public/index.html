<!doctype html>
<html lang="en-gb">
    <head>
        <meta charset="utf-8">
        <title>Visualiser</title>
    </head>
    <body>
        <script>
            const aisles = [
                {
                    "id": "93-8b-bc-dc-1f-ca",
                    "name": "Frozen Dinners",
                    "x1": 9,
                    "y1": 17,
                    "x2": 11,
                    "y2": 38
                },
                {
                    "id": "21-a8-f8-60-ef-a4",
                    "name": "Frozen Vegetables",
                    "x1": 9,
                    "y1": 38,
                    "x2": 11,
                    "y2": 61
                },
                {
                    "id": "97-0b-b7-ef-7b-5a",
                    "name": "Frozen Pizza",
                    "x1": 11,
                    "y1": 17,
                    "x2": 13,
                    "y2": 0
                },
                {
                    "id": "e8-df-b9-35-cd-ed",
                    "name": "French Fries",
                    "x1": 11,
                    "y1": 0,
                    "x2": 13,
                    "y2": 0
                },
                {
                    "id": "b2-3d-b8-be-ea-5f",
                    "name": "Breakfast",
                    "x1": 11,
                    "y1": 0,
                    "x2": 13,
                    "y2": 0
                },
                {
                    "id": "db-6a-e9-9c-be-ef",
                    "name": "Frozen Juice",
            "x1": 11,
            "y1": 0,
            "x2": 13,
            "y2": 0
            },
            {
            "id": "42-3d-a1-d2-37-b1",
            "name": "Food Protection",
            "x1": 19,
            "y1": 17,
            "x2": 21,
            "y2": 27
            },
            {
            "id": "0b-71-be-b0-98-a4",
            "name": "Shaving Needs",
            "x1": 19,
            "y1": 27,
            "x2": 21,
            "y2": 37
            },
            {
            "id": "bc-ef-4d-ac-2f-df",
            "name": "Facial Tissue",
            "x1": 19,
            "y1": 37,
            "x2": 21,
            "y2": 45
            },
            {
            "id": "e5-d3-df-69-fa-3c",
            "name": "Toilet Paper",
            "x1": 19,
            "y1": 45,
            "x2": 21,
            "y2": 52
            },
            {
            "id": "3e-e1-e3-cc-f9-e9",
            "name": "Paper Towels",
            "x1": 19,
            "y1": 52,
            "x2": 21,
            "y2": 61
            }
            ]
            const products_by_aisle = {
            "Frozen Dinners": [
            { name: "Lasagna", quantity: 5, price: 8.99 },
            { name: "Chicken Alfredo", quantity: 8, price: 7.49 },
            { name: "Beef Stroganoff", quantity: 6, price: 9.99 },
            { name: "Vegetarian Enchiladas", quantity: 7, price: 6.99 },
            { name: "Shrimp Scampi", quantity: 4, price: 12.99 },
            { name: "Teriyaki Chicken", quantity: 10, price: 10.49 },
            { name: "Cheese Ravioli", quantity: 3, price: 5.99 },
            { name: "Salmon Fillet", quantity: 2, price: 15.99 },
            { name: "Meatball Parmesan", quantity: 9, price: 8.49 },
            { name: "Vegetable Stir Fry", quantity: 5, price: 7.99 },
            ],
            "Frozen Vegetables": [
            { name: "Broccoli", quantity: 10, price: 3.99 },
            { name: "Peas and Carrots", quantity: 7, price: 2.99 },
            { name: "Mixed Vegetables", quantity: 8, price: 4.49 },
            { name: "Corn Kernels", quantity: 12, price: 1.99 },
            { name: "Spinach", quantity: 6, price: 5.99 },
            { name: "Brussels Sprouts", quantity: 4, price: 6.49 },
            { name: "Green Beans", quantity: 9, price: 3.49 },
            { name: "Cauliflower", quantity: 11, price: 4.99 },
            { name: "Asparagus", quantity: 3, price: 7.99 },
            { name: "Edamame", quantity: 5, price: 2.49 },
            ],
            "Frozen Pizza": [
            { name: "Pepperoni", quantity: 7, price: 9.99 },
            { name: "Margherita", quantity: 6, price: 8.49 },
            { name: "Supreme", quantity: 4, price: 10.99 },
            { name: "Vegetarian", quantity: 5, price: 7.99 },
            { name: "BBQ Chicken", quantity: 8, price: 11.49 },
            { name: "Hawaiian", quantity: 3, price: 10.99 },
            { name: "Four Cheese", quantity: 10, price: 8.99 },
            { name: "White Pizza", quantity: 7, price: 9.49 },
            { name: "Buffalo Chicken", quantity: 6, price: 11.99 },
            { name: "Mushroom and Olive", quantity: 9, price: 8.49 },
            ],
            "French Fries": [
            { name: "Crinkle Cut", quantity: 8, price: 3.49 },
            { name: "Shoestring", quantity: 10, price: 2.99 },
            { name: "Sweet Potato", quantity: 6, price: 4.99 },
            { name: "Curly Fries", quantity: 7, price: 3.99 },
            { name: "Waffle Fries", quantity: 9, price: 4.49 },
            { name: "Garlic Parmesan", quantity: 5, price: 5.49 },
            { name: "Chili Cheese", quantity: 4, price: 6.99 },
            { name: "Seasoned Wedges", quantity: 3, price: 5.99 },
            { name: "Steak Fries", quantity: 11, price: 3.49 },
            { name: "Loaded Fries", quantity: 7, price: 6.49 },
            ],
            "Breakfast": [
            { name: "Pancakes", quantity: 12, price: 4.99 },
            { name: "Waffles", quantity: 10, price: 3.99 },
            { name: "Breakfast Burrito", quantity: 6, price: 5.99 },
            { name: "Eggs Benedict", quantity: 4, price: 8.99 },
            { name: "French Toast Sticks", quantity: 8, price: 4.49 },
            { name: "Sausage Links", quantity: 7, price: 6.99 },
            { name: "Hash Browns", quantity: 9, price: 2.99 },
            { name: "Cereal", quantity: 10, price: 3.49 },
            { name: "Oatmeal", quantity: 5, price: 4.99 },
            { name: "Granola", quantity: 8, price: 5.49 },
            ],
            "Frozen Juice": [
            { name: "Orange Juice", quantity: 10, price: 3.99 },
            { name: "Apple Juice", quantity: 8, price: 4.49 },
            { name: "Grape Juice", quantity: 7, price: 4.99 },
            { name: "Mixed Berry Smoothie", quantity: 6, price: 5.49 },
            { name: "Pineapple Coconut Drink", quantity: 9, price: 6.99 },
            { name: "Mango Tango", quantity: 5, price: 5.99 },
            { name: "Strawberry Lemonade", quantity: 8, price: 4.49 },
            { name: "Pomegranate Blueberry Blend", quantity: 7, price: 6.49 },
            { name: "Cranberry Juice", quantity: 4, price: 3.99 },
            { name: "Watermelon Mint Cooler", quantity: 6, price: 7.49 },
            ]
            }
            const purchases_by_customer = [
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "product_name": "Lasagna",
            "quantity": 2,
            "time": Date.now() + 50000
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "product_name": "Broccoli",
            "quantity": 1,
            "time": Date.now() + 60000
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "product_name": "Orange Juice",
            "quantity": 1,
            "time": Date.now() + 76000
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "product_name": "Pancakes",
            "quantity": 1,
            "time": Date.now() + 80000
            }
            ];
            const customers = [
            {
            "id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "name": "gokdis",
            "email": "gokdis@std.izmirekonomi.edu.tr",
            "password": "858fc78909bdbfa131796f697591ba5152f0eae7a32bbd764e2731e7670de068"
            }
            ]
            const behavior_by_customer = [
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 116,
            "y": 100,
            "time": Date.now(),
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 113,
            "y": 77,
            "time": Date.now() + 5000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 110,
            "y": 52,
            "time": Date.now() + 5000 + 5000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 110,
            "y": 17,
            "time": Date.now() + 5000 + 5000 + 5000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 98,
            "y": 18,
            "time": Date.now() + 5000 + 5000 + 5000 + 5000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 73,
            "y": 18,
            "time": Date.now() + 5000 + 5000 + 5000 + 5000 + 5000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 47,
            "y": 17,
            "time": Date.now() + 5000 + 5000 + 5000 + 5000 + 5000 + 5000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 18,
            "y": 18,
            "time": Date.now() + 5000 + 5000 + 5000 + 5000 + 5000 + 5000 + 5000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 10,
            "y": 18,
            "time": Date.now() + 5000 + 5000 + 5000 + 5000 + 5000 + 5000 + 5000 + 5000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 5,
            "y": 20,
            "time": Date.now() + 5000 + 5000 + 5000 + 5000 + 5000 + 5000 + 5000 + 5000 + 5000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 10,
            "y": 30,
            "time": Date.now() + 5000 + 5000 + 5000 + 5000 + 5000 + 5000 + 5000 + 5000 + 5000 + 5000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 6,
            "y": 40,
            "time": Date.now() + 55000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 10,
            "y": 50,
            "time": Date.now() + 60000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 3,
            "y": 60,
            "time": Date.now() + 65000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 3,
            "y": 80,
            "time": Date.now() + 70000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 15,
            "y": 75,
            "time": Date.now() + 75000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 15,
            "y": 50,
            "time": Date.now() + 80000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 16,
            "y": 76,
            "time": Date.now() + 85000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 39,
            "y": 80,
            "time": Date.now() + 90000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 44,
            "y": 89,
            "time": Date.now() + 95000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 67,
            "y": 90,
            "time": Date.now() + 100000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 94,
            "y": 90,
            "time": Date.now() + 105000,
            },
            {
            "customer_id": "53bff3f9-78b3-4dd3-a485-08c2d05c2d2b",
            "x": 94,
            "y": 101,
            "time": Date.now() + 110000,
            }
            ]
            const trail = []
            const unit = 25 // px
            const canvas = document.createElement('canvas');
            canvas.width = 160 * unit;
            canvas.height = 102 * unit;
            document.body.appendChild(canvas);
            const context = canvas.getContext('2d');
            const img = new Image();
            img.src = 'supermarket.png';
            let x;
            let y;
            let currentBehaviorIndex = 0;
            let startTime;
            const customerImg = new Image();
            customerImg.src = 'customer.png';
            function drawProductText(productName, x, y) {
            context.fillText(productName, x, y);
            }
            function drawCustomer(x, y) {
            context.drawImage(customerImg, x, y, unit, unit);
            }
            let lastPurchaseTime = 0;
            let purchasedProductCount = 0;
            function animateCustomer() {
            if (currentBehaviorIndex < behavior_by_customer.length - 1) {
                                       const currentTime = Date.now();
                                       const startBehavior = behavior_by_customer[currentBehaviorIndex];
                                       const endBehavior = behavior_by_customer[currentBehaviorIndex + 1];
                                       const elapsedTime = endBehavior.time - startBehavior.time;
                                       const progress = (currentTime - startBehavior.time) / elapsedTime;
                                       const currentX = startBehavior.x * unit + (endBehavior.x * unit - startBehavior.x * unit) * progress;
                                       const currentY = startBehavior.y * unit + (endBehavior.y * unit - startBehavior.y * unit) * progress;
                                       context.clearRect(0, 0, canvas.width, canvas.height);
                                       purchases_by_customer.forEach((purchase) => {
                purchasedProductCount++;
                if (currentTime >= purchase.time) {
                    drawProductText(`${purchase.product_name} x${purchase.quantity}`, currentX, currentY + (purchasedProductCount + 1) * unit);
                    lastPurchaseTime = purchase.time;
                    }
                    });
                    purchasedProductCount = 0;
                    context.drawImage(img, 0, 0, canvas.width, canvas.height);
                    context.font = unit + 'px Liberation Serif';
                    context.fillText('(' + Math.floor(x / unit) + ', ' + Math.floor(y / unit) + ')', x, y);
                    context.fillText('(' + Math.floor(currentX / unit) + ', ' + Math.floor(currentY / unit) + ')', currentX, currentY);
                    trail.push([currentX + unit / 2, currentY + unit / 2]);
                    drawCustomer(currentX, currentY);

  for (let i = 0; i < trail.length; i++) {
    const [trailX, trailY] = trail[i]
    context.fillRect(trailX, trailY, 2, 2)
  }
const maxTrailLength = 10000;
  if (trail.length > maxTrailLength) {
    trail.shift();
  }
                    if (progress < 1) {
requestAnimationFrame(animateCustomer);
                                   } else {
                                   currentBehaviorIndex++;
                                   if (currentBehaviorIndex >= behavior_by_customer.length - 1) {
                        currentBehaviorIndex = 0;
                        return;
                        }
                        startTime = Date.now();
                        requestAnimationFrame(animateCustomer);
                        }
                        }
                        }
                        function startAnimation() {
                        startTime = Date.now();
                        animateCustomer();
                        }
                        startAnimation();
                        canvas.addEventListener('mousemove', function (event) {
                        var rect = canvas.getBoundingClientRect();
                        x = event.clientX - rect.left;
                        y = event.clientY - rect.top;
                        });
        </script>
    </body>
</html>
